<%- include('../layoutsUser/userheader') %>
<style>
.small-title {
   font-size: 3rem;
   color: black;
}
.welcome{
   padding-left: 420px;
   padding-bottom: 67px;
   padding-top: 36px;
   margin-bottom: -29px;
   font-size: 50px;
   background-color: grey;
   font-family:'Times New Roman', Times, serif;
}

.title-lg{
    font-size: 40px;
    padding-top: 30px;
    font-family:'Times New Roman', Times, serif;
}
.owl-carousel .product {
    margin-bottom: -50px !important;
}
.product-image{
    height: 280px;
}

.hero-section {
    position: relative;
    margin-bottom: 4rem;
    overflow: hidden;
}

.hero-image {
    width: 100%;
    height: 500px;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
}

.hero-content {
    text-align: center;
    color: #fff;
    max-width: 800px;
    padding: 2rem;
}

.hero-title {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: white;
    text-shadow: 2px 2px 4px rgb(44, 33, 33);
}

.hero-description {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    line-height: 1.6;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.hero-button {
    display: inline-block;
    background-color: #fff;
    color: #000;
    font-size: 1rem;
    font-weight: 600;
    padding: 1rem 2rem;
    border-radius: 4px;
    text-transform: uppercase;
    transition: all 0.3s ease;
    text-decoration: none;
}

.hero-button:hover {
    background-color: transparent;
    color: #fff;
    border: 2px solid #fff;
}

/* Offer Styling */
.product-price {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.original-price {
    text-decoration: line-through;
    color: #999;
    font-size: 0.9em;
    margin-bottom: 0.2rem;
}
.discount-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #e53637;
    color: white;
    padding: 0.3rem 0.6rem;
    border-radius: 3px;
    font-size: 0.8rem;
    font-weight: bold;
    z-index: 1;
}

.category-mosaic {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        grid-auto-rows: auto;
        gap: 0;
        margin-bottom: 4rem;
    }
    
    .category-item {
        position: relative;
        overflow: hidden;
        aspect-ratio: 1/1;
    }
    
    .category-item-xl {
        grid-column: span 2;
        grid-row: span 2;
    }
    
    .category-item-lg {
        grid-column: span 2;
        grid-row: span 2;
    }
    
    .category-item-md {
        grid-column: span 2;
        grid-row: span 2;
    }
    
    .category-item-sm {
        grid-column: span 2;
        grid-row: span 2;
    }
    
    .category-banner {
        position: relative;
        height: 100%;
        width: 100%;
    }
    
    .category-banner img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }
    
    .category-banner:hover img {
        transform: scale(1.05);
    }
    
    .category-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        transition: background 0.3s;
    }
    
    .category-banner:hover .category-overlay {
        background: rgba(0, 0, 0, 0.5);
    }
    
    .category-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: #fff;
        width: 80%;
        z-index: 1;
    }
    
    .category-title {
        font-size: 1.25rem;
        margin-bottom: 1rem;
        font-weight: 700;
        color: #fff;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
    }
    
    .category-banner .btn {
        border: 2px solid #fff;
        color: #fff;
        font-weight: 500;
        padding: 0.5rem 1rem;
        text-transform: uppercase;
        font-size: 0.875rem;
        transition: all 0.3s;
    }
    
    .category-banner .btn:hover {
        background-color: #fff;
        color: #000;
    }
    
    @media (min-width: 1200px) {
        .category-mosaic {
            grid-template-columns: repeat(6, 1fr);
        }
        
        .category-item-xl {
            grid-column: span 3;
            grid-row: span 3;
        }
        
        .category-item-lg {
            grid-column: span 3;
            grid-row: span 3;
        }
        
        .category-item-md {
            grid-column: span 2;
            grid-row: span 3;
        }
        
        .category-item-sm {
            grid-column: span 2;
            grid-row: span 3;
        }
    }
    
    @media (min-width: 992px) and (max-width: 1199px) {
        .category-mosaic {
            grid-template-columns: repeat(4, 1fr);
        }
        
        .category-item-xl, .category-item-lg {
            grid-column: span 2;
            grid-row: span 2;
        }
        
        .category-item-md, .category-item-sm {
            grid-column: span 2;
            grid-row: span 2;
        }
    }
    
    @media (min-width: 768px) and (max-width: 991px) {
        .category-mosaic {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .category-item {
            grid-column: span 1;
            grid-row: span 1;
        }
    }
    
    @media (max-width: 767px) {
        .category-mosaic {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .category-item {
            grid-column: span 1;
            grid-row: span 1;
        }
    }
    .main{
        background-color: gray;
    }
    .product-body{
        background-color: rgb(186, 183, 183);
    }
    .top{
        color: white;
    }
</style>
        <main class="main">
                <h4 class="welcome">Welcome to Nestoria</h4>
                <div class="hero-section">
                    <img src="images/black-sofa_1268-31803.avif" alt="Nestoria Featured Image" class="hero-image">
                    <div class="hero-overlay">
                        <div class="hero-content">
                            <h1 class="hero-title">Discover Elegance at Nestoria</h1>
                            <p class="hero-description">
                                Nestoria brings you a curated collection of high-quality products designed to transform your living space. 
                                From stylish furniture to elegant home decor, we offer everything you need to create the perfect home environment.
                                Experience exceptional craftsmanship, timeless designs, and unmatched quality.
                            </p>
                            <a href="/shop" class="hero-button">Shop Now</a>
                        </div>
                    </div>
                </div>  
            <div class="container">
                <div class="heading heading-center mb-3">
                    <h2 class="title-lg">Trendy Products</h2>
                    <p class="top">Top selling products </p>
                </div>
                <div class="tab-content tab-content-carousel">
                    <div class="tab-pane p-0 fade show active" id="trendy-all-tab" role="tabpanel" aria-labelledby="trendy-all-link">
                        <div class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow" data-toggle="owl" 
                            data-owl-options='{
                                "nav": false, 
                                "dots": true,
                                "margin": 20,
                                "loop": false,
                                "responsive": {
                                    "0": { "items":2 },
                                    "480": { "items":2 },
                                    "768": { "items":3 },
                                    "992": { "items":4 },
                                    "1200": { "items":4, "nav": true, "dots": false }
                                }
                            }'> 
                            <% 
                            // Get current date for offer validation
                            const currentDate = new Date();
                            
                            // Loop through each product
                            products.forEach(async product => { 
                                // Initialize hasOffer and offerPrice variables
                                let hasOffer = false;
                                let offerPrice = product.regularPrice;
                                let discountPercentage = 0;
                                
                                // Check for product offers
                                if (product.offers && product.offers.length > 0) {
                                    // Find active offer with the highest discount
                                    const activeOffers = product.offers.filter(offer => 
                                        offer.status === 'Active' && 
                                        new Date(offer.expireDate) > currentDate
                                    );
                                    
                                    if (activeOffers.length > 0) {
                                        // Sort by discount amount (highest first)
                                        activeOffers.sort((a, b) => b.discount - a.discount);
                                        const highestOffer = activeOffers[0];
                                        
                                        hasOffer = true;
                                        discountPercentage = highestOffer.discount;
                                        offerPrice = (product.regularPrice * (1 - discountPercentage / 100)).toFixed(2);
                                    }
                                }
                            %>
                            <div class="product product-11 text-center">
                                <figure class="product-media">
                                    <% if (hasOffer) { %>
                                        <div class="discount-badge">-<%= discountPercentage %>%</div>
                                    <% } %>
                                    <a href="/product/<%= product._id %>">
                                        <img src="/uploads/<%= product.productImage[0] %>" alt="<%= product.productName %>" class="product-image">
                                        <% if (product.productImage[1]) { %>
                                            <img src="/uploads/<%= product.productImage[1] %>" alt="<%= product.productName %>" class="product-image-hover">
                                        <% } %>
                                    </a>
                                </figure>
                                <div class="product-body">
                                    <h3 class="product-title"><a href="/product/<%= product._id %>"><%= product.productName %></a></h3>
                                    <div class="product-price">
                                        <% if (hasOffer) { %>
                                            <span class="original-price">₹<%= product.regularPrice %></span>
                                            <span class="offer-price">₹<%= offerPrice %></span>
                                        <% } else { %>
                                            ₹<%= product.regularPrice %>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </div><!-- End .container -->
            <div class="container-fluid">
                <div class="heading heading-center mb-3">
                    <h2 class="title-lg">Shop by Categories</h2>
                    <p class="top">Explore our collection by category</p>
                </div>
            
                <div class="category-mosaic">
                    <% let categoryCount = 0; %>
                    <% categories.slice(0, 5).forEach((category, index) => { %>
                        <% 
                            // Find products for this category
                            const categoryProducts = products.filter(product => 
                                product.category && product.category._id.toString() === category._id.toString()
                            );
                            
                            // Skip if no products
                            if (categoryProducts.length === 0) return;
                            
                            // Get first product image for display
                            const displayProduct = categoryProducts[0];
                            if (!displayProduct) return;
                            
                            // Determine size class based on index - more subtle differences
                            let sizeClass = "";
                            if (index % 5 === 0) sizeClass = "category-item-xl";
                            else if (index % 5 === 1) sizeClass = "category-item-lg";
                            else if (index % 5 === 2) sizeClass = "category-item-md";
                            else sizeClass = "category-item-sm";
                            
                            categoryCount++;
                            if (categoryCount > 5) return;
                        %>
                        
                        <div class="category-item <%= sizeClass %>">
                            <div class="category-banner">
                                <a href="/shop?Category=<%= encodeURIComponent(category.name) %>">
                                    <img src="/uploads/<%= displayProduct.productImage[0] %>" alt="<%= category.name %>" class="img-fluid">
                                    <div class="category-overlay"></div>
                                    <div class="category-content">
                                        <h3 class="category-title"><%= category.name %></h3>
                                        <a href="/shop?Category=<%= encodeURIComponent(category.name) %>" class="btn btn-outline-white">Shop Now</a>
                                    </div>
                                </a>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </main><!-- End .main -->

 <%- include('../layoutsUser/userfooter') %>